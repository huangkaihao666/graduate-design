#!/bin/sh
. "$(dirname "$0")/_/husky.sh"

# 获取提交信息
commit_msg=$(cat "$1")

# 验证提交信息格式
# 允许的前缀: feat, fix, docs, style, refactor, test, chore, ci, perf, revert
if ! echo "$commit_msg" | grep -qE "^(feat|fix|docs|style|refactor|test|chore|ci|perf|revert)(\(.+\))?!?: .{1,}"; then
  # 也允许合并提交
  if ! echo "$commit_msg" | grep -qE "^Merge"; then
    echo "❌ 提交信息格式不符合规范！"
    echo ""
    echo "规范格式: <type>(<scope>): <subject>"
    echo ""
    echo "允许的类型:"
    echo "  feat     - 新功能"
    echo "  fix      - 错误修复"
    echo "  docs     - 文档更新"
    echo "  style    - 代码风格调整"
    echo "  refactor - 代码重构"
    echo "  test     - 测试相关"
    echo "  chore    - 构建、依赖等杂务"
    echo "  ci       - CI/CD配置"
    echo "  perf     - 性能优化"
    echo "  revert   - 回滚提交"
    echo ""
    echo "示例: feat(auth): 实现用户登录功能"
    echo "示例: fix: 修复导航栏样式问题"
    exit 1
  fi
fi
