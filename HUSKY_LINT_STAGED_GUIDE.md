# Husky + Lint-staged æäº¤å‰è‡ªåŠ¨åŒ–æ£€æŸ¥æŒ‡å—

## ğŸ“‹ æ¦‚è¿°

è¿™ä¸ªé¡¹ç›®ä½¿ç”¨ **Husky** å’Œ **Lint-staged** æ¥åœ¨ Git æäº¤å‰è‡ªåŠ¨æ‰§è¡Œä»£ç æ£€æŸ¥å’Œæ ¼å¼åŒ–ï¼Œç¡®ä¿ä»£ç è´¨é‡å’Œå›¢é˜Ÿè§„èŒƒä¸€è‡´æ€§ã€‚

## ğŸ”„ å·¥ä½œæµç¨‹

```
ç”¨æˆ·æ‰§è¡Œ git commit
         â†“
Husky æ‹¦æˆª commit æ“ä½œ
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Pre-commit Hook æ‰§è¡Œ                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1. è¿è¡Œ lint-staged                      â”‚
â”‚ 2. è·å–æ‰€æœ‰ staged æ–‡ä»¶                   â”‚
â”‚ 3. æŒ‰æ–‡ä»¶ç±»å‹æ‰§è¡Œæ£€æŸ¥å’Œä¿®å¤               â”‚
â”‚    â”œâ”€ .ts/.tsx/.js/.vue â†’ ESLint + Prettier
â”‚    â”œâ”€ .less/.css/.scss â†’ Stylelint + Prettier
â”‚    â””â”€ .json/.md â†’ Prettier
â”‚ 4. è‡ªåŠ¨ä¿®å¤çš„é—®é¢˜ä¼šé‡æ–° stage             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Commit-msg Hook æ‰§è¡Œ                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1. éªŒè¯æäº¤ä¿¡æ¯æ ¼å¼                      â”‚
â”‚ 2. æ£€æŸ¥æ˜¯å¦ç¬¦åˆ Conventional Commits     â”‚
â”‚ 3. ä¸ç¬¦åˆè§„èŒƒåˆ™ä¸­æ–­å¹¶æ˜¾ç¤ºé”™è¯¯            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
âœ… æ‰€æœ‰æ£€æŸ¥é€šè¿‡ â†’ æäº¤æˆåŠŸ
âŒ ä»»ä½•æ£€æŸ¥å¤±è´¥ â†’ æäº¤ä¸­æ–­å¹¶æ˜¾ç¤ºè¯¦ç»†é”™è¯¯
```

## ğŸ“ æäº¤ä¿¡æ¯è§„èŒƒ (Conventional Commits)

### æ ¼å¼

```
<type>(<scope>): <subject>
```

### å…è®¸çš„ç±»å‹

| ç±»å‹       | è¯´æ˜             | ç¤ºä¾‹                            |
| ---------- | ---------------- | ------------------------------- |
| `feat`     | æ–°åŠŸèƒ½           | `feat(auth): å®ç°ç”¨æˆ·ç™»å½•åŠŸèƒ½`  |
| `fix`      | é”™è¯¯ä¿®å¤         | `fix(nav): ä¿®å¤å¯¼èˆªæ æ ·å¼é—®é¢˜`  |
| `docs`     | æ–‡æ¡£æ›´æ–°         | `docs(README): æ›´æ–°å®‰è£…è¯´æ˜`    |
| `style`    | ä»£ç é£æ ¼è°ƒæ•´     | `style: è°ƒæ•´ç¼©è¿›å’Œæ ¼å¼`         |
| `refactor` | ä»£ç é‡æ„         | `refactor(utils): ä¼˜åŒ–å·¥å…·å‡½æ•°` |
| `test`     | æµ‹è¯•ç›¸å…³         | `test(login): æ·»åŠ ç™»å½•åŠŸèƒ½æµ‹è¯•` |
| `chore`    | æ„å»ºã€ä¾èµ–ç­‰æ‚åŠ¡ | `chore: å‡çº§ä¾èµ–ç‰ˆæœ¬`           |
| `ci`       | CI/CD é…ç½®       | `ci: æ·»åŠ  GitHub Actions`       |
| `perf`     | æ€§èƒ½ä¼˜åŒ–         | `perf: ä¼˜åŒ–æ¸²æŸ“æ€§èƒ½`            |
| `revert`   | å›æ»šæäº¤         | `revert: å›æ»šä¹‹å‰çš„åŠŸèƒ½`        |

### ç¤ºä¾‹

**âœ… æ­£ç¡®çš„æäº¤ä¿¡æ¯**

```bash
feat(auth): å®ç°ç”¨æˆ·ç™»å½•åŠŸèƒ½
fix: ä¿®å¤å¯¼èˆªæ æ ·å¼é—®é¢˜
docs(README): æ›´æ–°å®‰è£…è¯´æ˜
refactor(utils): ä¼˜åŒ–å·¥å…·å‡½æ•°ç»“æ„
```

**âŒ é”™è¯¯çš„æäº¤ä¿¡æ¯**

```bash
update code              # âŒ ç¼ºå°‘ç±»å‹
feat å®ç°æ–°åŠŸèƒ½          # âŒ ç¼ºå°‘å†’å·
feature: æ–°åŠŸèƒ½          # âŒ ä¸æ˜¯å…è®¸çš„ç±»å‹
```

## ğŸ›  æ–‡ä»¶å¤„ç†è§„åˆ™

### `.lintstagedrc.json` é…ç½®

```json
{
  "*.{js,jsx,mjs,cjs,ts,tsx}": ["eslint --fix", "prettier --write"],
  "*.vue": ["eslint --fix", "prettier --write"],
  "*.{css,scss,less}": ["stylelint --fix", "prettier --write"],
  "*.{json,md}": ["prettier --write"]
}
```

### ä¸åŒæ–‡ä»¶ç±»å‹çš„å¤„ç†

#### TypeScript/JavaScript æ–‡ä»¶ (_.ts, _.tsx, _.js, _.jsx, _.mjs, _.cjs)

```bash
eslint --fix          # è‡ªåŠ¨ä¿®å¤ ESLint é”™è¯¯
prettier --write      # è‡ªåŠ¨æ ¼å¼åŒ–ä»£ç 
```

#### Vue ç»„ä»¶ (\*.vue)

```bash
eslint --fix          # è‡ªåŠ¨ä¿®å¤ ESLint é”™è¯¯
prettier --write      # è‡ªåŠ¨æ ¼å¼åŒ–ä»£ç 
```

#### æ ·å¼æ–‡ä»¶ (_.css, _.scss, \*.less)

```bash
stylelint --fix       # è‡ªåŠ¨ä¿®å¤æ ·å¼é”™è¯¯
prettier --write      # è‡ªåŠ¨æ ¼å¼åŒ–æ ·å¼
```

#### å…¶ä»–æ–‡ä»¶ (_.json, _.md)

```bash
prettier --write      # è‡ªåŠ¨æ ¼å¼åŒ–
```

## ğŸš€ å¸¸è§åœºæ™¯

### åœºæ™¯ 1: æ­£å¸¸æäº¤æµç¨‹

```bash
# 1. ç¼–å†™ä»£ç 
vim src/components/Login.vue

# 2. æäº¤æ›´æ”¹
git add .
git commit -m "feat(auth): å®ç°ç”¨æˆ·ç™»å½•åŠŸèƒ½"

# Husky è‡ªåŠ¨æ‰§è¡Œ:
# âœ” Running lint-staged...
# âœ” Applying modifications from tasks...
# âœ” Cleaning up temporary files...
# [main abc1234] feat(auth): å®ç°ç”¨æˆ·ç™»å½•åŠŸèƒ½
```

### åœºæ™¯ 2: ä»£ç æœ‰ ESLint é”™è¯¯

```bash
git add .
git commit -m "feat: æ–°åŠŸèƒ½"

# âŒ ESLint æ£€æŸ¥å¤±è´¥
# /src/components/Login.vue
#   5:5  error  'unused' is assigned but never used  no-unused-vars
#
# æäº¤è¢«ä¸­æ–­ï¼ŒHusky ä¼šè‡ªåŠ¨ä¿®å¤èƒ½ä¿®å¤çš„é—®é¢˜
# å¯¹äºæ— æ³•è‡ªåŠ¨ä¿®å¤çš„é”™è¯¯ï¼Œéœ€è¦æ‰‹åŠ¨ä¿®å¤

# 3. æ‰‹åŠ¨ä¿®å¤é”™è¯¯
vim src/components/Login.vue

# 4. é‡æ–°æäº¤
git add .
git commit -m "feat: æ–°åŠŸèƒ½"
```

### åœºæ™¯ 3: æäº¤ä¿¡æ¯ä¸ç¬¦åˆè§„èŒƒ

```bash
git commit -m "update code"

# âŒ æäº¤ä¿¡æ¯æ ¼å¼ä¸ç¬¦åˆè§„èŒƒï¼
# è§„èŒƒæ ¼å¼: <type>(<scope>): <subject>
#
# å…è®¸çš„ç±»å‹:
#   feat     - æ–°åŠŸèƒ½
#   fix      - é”™è¯¯ä¿®å¤
#   docs     - æ–‡æ¡£æ›´æ–°
#   ...
#
# ç¤ºä¾‹: feat(auth): å®ç°ç”¨æˆ·ç™»å½•åŠŸèƒ½
# ç¤ºä¾‹: fix: ä¿®å¤å¯¼èˆªæ æ ·å¼é—®é¢˜
#
# æäº¤è¢«ä¸­æ–­
```

é‡æ–°ä½¿ç”¨æ­£ç¡®çš„æ ¼å¼æäº¤ï¼š

```bash
git commit -m "feat: æ·»åŠ æ–°åŠŸèƒ½"
```

### åœºæ™¯ 4: è·³è¿‡ Hooks (ä»…åœ¨å¿…è¦æ—¶)

> âš ï¸ **ä¸æ¨èä½¿ç”¨ï¼Œä»…åœ¨ç´§æ€¥æƒ…å†µä¸‹ä½¿ç”¨**

```bash
# è·³è¿‡æ‰€æœ‰ hooks
git commit -m "feat: ..." --no-verify

# è·³è¿‡ pre-commit hook (ä»ç„¶éªŒè¯æäº¤ä¿¡æ¯)
HUSKY=0 git commit -m "feat: ..."
```

## ğŸ“¦ é¦–æ¬¡å…‹éš†ä»“åº“

æ–°å›¢é˜Ÿæˆå‘˜å…‹éš†ä»“åº“åï¼ŒHusky hooks ä¼šè‡ªåŠ¨å®‰è£…ï¼š

```bash
# 1. å…‹éš†ä»“åº“
git clone https://github.com/huangkaihao666/graduate-design.git
cd graduate-design

# 2. å®‰è£…ä¾èµ–
pnpm install

# æ­¤æ—¶ Husky ä¼šè‡ªåŠ¨:
# âœ” husky - Git hooks installed
# âœ” Pre-commit å’Œ commit-msg hooks å·²å¯ç”¨
```

## ğŸ”§ é…ç½®æ–‡ä»¶ä½ç½®

| æ–‡ä»¶                     | è¯´æ˜                      |
| ------------------------ | ------------------------- |
| `.husky/pre-commit`      | æäº¤å‰æ£€æŸ¥å’Œæ ¼å¼åŒ–çš„ hook |
| `.husky/commit-msg`      | æäº¤ä¿¡æ¯éªŒè¯çš„ hook       |
| `.husky/_/husky.sh`      | Husky æ ¸å¿ƒè„šæœ¬            |
| `.lintstagedrc.json`     | Lint-staged é…ç½®          |
| `package.json` (prepare) | Husky åˆå§‹åŒ–è„šæœ¬          |

## ğŸ“š å…³è”å·¥å…·

- **ESLint**: ä»£ç è´¨é‡æ£€æŸ¥ (JavaScript/TypeScript/Vue)
- **Prettier**: ä»£ç æ ¼å¼åŒ–
- **Stylelint**: CSS/Less/SCSS æ ·å¼æ£€æŸ¥
- **Husky**: Git hooks ç®¡ç†å·¥å…·
- **Lint-staged**: åœ¨ Git æš‚å­˜åŒºä¸Šè¿è¡Œ linters

## ğŸ’¡ æœ€ä½³å®è·µ

1. **å®šæœŸæäº¤**: é¢‘ç¹æäº¤å°çš„ã€æœ‰æ„ä¹‰çš„æ›´æ”¹
2. **æ¸…æ™°çš„æäº¤ä¿¡æ¯**: ä½¿ç”¨è§„èŒƒæ ¼å¼ï¼Œä¾¿äºç†è§£å’Œè¿½è¸ª
3. **ä¿®å¤æ‰€æœ‰é”™è¯¯**: ä¸è¦è·³è¿‡ hooksï¼Œç¡®ä¿ä»£ç è´¨é‡
4. **å›¢é˜Ÿåä½œ**: è®©æ‰€æœ‰å›¢é˜Ÿæˆå‘˜ç†è§£å¹¶éµå®ˆè§„èŒƒ

## â“ å¸¸è§é—®é¢˜

### Q: ä¸ºä»€ä¹ˆæˆ‘çš„æäº¤è¢«æ‹’ç»äº†ï¼Ÿ

A: å¯èƒ½æ˜¯ä»¥ä¸‹åŸå› ï¼š

- ä»£ç æœ‰ ESLint/Stylelint é”™è¯¯æ— æ³•è‡ªåŠ¨ä¿®å¤ â†’ æ‰‹åŠ¨ä¿®å¤
- æäº¤ä¿¡æ¯ä¸ç¬¦åˆè§„èŒƒ â†’ ä½¿ç”¨æ­£ç¡®çš„æ ¼å¼é‡æ–°æäº¤

### Q: Husky è‡ªåŠ¨ä¿®å¤äº†æˆ‘çš„ä»£ç ï¼Œæˆ‘è¯¥æ€ä¹ˆåŠï¼Ÿ

A: Husky åªä¼šä¿®å¤èƒ½è‡ªåŠ¨ä¿®å¤çš„é—®é¢˜ï¼ˆå¦‚æ ¼å¼åŒ–ã€ç¼©è¿›ç­‰ï¼‰ï¼Œè¿™äº›ä¿®å¤åçš„æ–‡ä»¶ä¼šè‡ªåŠ¨æ·»åŠ åˆ°æš‚å­˜åŒºã€‚ä½ å¯ä»¥ï¼š

- æŸ¥çœ‹ä¿®æ”¹ï¼š`git diff --staged`
- æäº¤ï¼š`git commit` ï¼ˆä½¿ç”¨ä¹‹å‰çš„æäº¤ä¿¡æ¯ï¼‰

### Q: æˆ‘éœ€è¦è·³è¿‡ hooks æ€ä¹ˆåŠï¼Ÿ

A: è™½ç„¶ä¸æ¨èï¼Œä½†å¯ä»¥ä½¿ç”¨ `--no-verify` æ ‡å¿—ï¼š

```bash
git commit -m "feat: ..." --no-verify
```

### Q: å¦‚ä½•ç¦ç”¨ Huskyï¼Ÿ

A: åœ¨ç¯å¢ƒå˜é‡ä¸­è®¾ç½® `HUSKY=0`ï¼š

```bash
HUSKY=0 git commit -m "feat: ..."
```

æˆ–è€…ä¸´æ—¶ç¦ç”¨æ‰€æœ‰ hooksï¼š

```bash
git config core.hooksPath /dev/null
```

## ğŸ”— æ›´å¤šä¿¡æ¯

- [Husky å®˜æ–¹æ–‡æ¡£](https://typicode.github.io/husky/)
- [Lint-staged å®˜æ–¹æ–‡æ¡£](https://github.com/okonet/lint-staged)
- [Conventional Commits](https://www.conventionalcommits.org/)
